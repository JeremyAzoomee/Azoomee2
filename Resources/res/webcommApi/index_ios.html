<html>
	<head>
		<title>Game storage API</title>
	</head>
	<body>
		
		<iframe style="width: 100%; height: 100%" src="sender.html"></iframe>
		<script>
			//creating iframe element
			
			var contentUrl = getUrlVars()["contentUrl"];
			var iframe = document.createElement('iframe');
			iframe.src = contentUrl;
			
			window.addEventListener("message", receiveMessage, false);
			
			//When a message comes, write all elements of localStorage to file
			
			function receiveMessage(event)
			{
				for(var i = 0; i < localStorage.length; i++)
				{
					var title = localStorage.key(i);
					var data = localStorage.getItem(i);
					window.location.href = "senddata://writeDataToFile?title="+ title +"&data=" + data;
				}   
    			return;
			}
			
			//After load, this method gets run by native to set localStorage data up
        
            function setLocalData(title, data)
            {
            	localStorage["title"] = data;
            }
		</script>
	</body>
</html>
