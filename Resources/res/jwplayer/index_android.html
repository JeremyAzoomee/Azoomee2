<!DOCTYPE HTML>
	<head>
		<title>JW Player</title>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body bgcolor="black">

		<script src="./jwplayer/jwplayer.js"></script>
		<script>jwplayer.key="BwwBSuXdS5gq/y1wfVzLoplRmFNIiRxUmmVA4PcvyYL3EkiA";</script>

		<div id="videoPlayer"></div>
		<script type="text/javascript">
			var sent0 = false;
			var sent25 = false;
			var sent50 = false;
			var sent75 = false;
			var firstPlaylistElement = true; //android jwplayer sends 2 playlistItem events on start

			var contentUrl = getUrlVars()["contentUrl"];
			var playerInstance = jwplayer("videoPlayer");

			var receivedPlaylist = atob(NativeInterface.getVideoPlaylist());

			var contentUrl = getUrlVars()["contentUrl"];
			var playerInstance = jwplayer("videoPlayer");

			var playListArray = [];
			var jumpToThisElement = -1;

			if(receivedPlaylist == "noPlaylist")
			{
				playListArray.push({file: contentUrl, mediaid: "episode"});
				jumpToThisElement = 0;
			}
			else
			{
				receivedPlaylist = JSON.parse(receivedPlaylist);

				for(i = 0; i < receivedPlaylist["Elements"].length; i++)
				{
					var uri = receivedPlaylist["Elements"][i]["uri"];
					var imageuri = receivedPlaylist["Elements"][i]["image"];
					var titleText = receivedPlaylist["Elements"][i]["title"];

					playListArray.push({file: uri, mediaid: "episode", image: imageuri, title: titleText});
					if(uri == contentUrl) jumpToThisElement = i;

					console.log("JWPLAYER - uri: " + uri + " image: " + imageuri + " title: " + titleText);
				}
			}

			playerInstance.setup
			({
    			playlist: playListArray,
    			repeat: false,
    			stretching: "exactfit",
    			mediaid: "azoomeeplayer",
    			height: "100%",
      			width: "100%"
			});

			jwplayer().playlistItem(jumpToThisElement);

			jwplayer().on('error', function(event){
				getBackToLoginScreen();
			});

			jwplayer().on('setupError', function(event){
				getBackToLoginScreen();
			});

			jwplayer().on('play', function(event){
				console.log("play");
				if(document.getElementById("loadingPage"))
				{
					var loadingScreen = document.getElementById("loadingPage");
					loadingScreen.parentElement.removeChild(loadingScreen);
				}

				NativeInterface.sendMediaPlayerData("play", "");
			});

			jwplayer().on('ready', function(event){
				startPlayBack();
			});

			jwplayer().on('pause', function(event){
				NativeInterface.sendMediaPlayerData("pause", "");
			});

			jwplayer().on('visualQuality', function(event){
				var currentQuality = jwplayer().getVisualQuality().level;
				NativeInterface.sendMediaPlayerData("quality", currentQuality["height"]);
			});

			jwplayer().on('time', function(event){
				var totalDuration = jwplayer().getDuration();
				var currentPosition = jwplayer().getPosition();

				var percentage = currentPosition / totalDuration * 100;

				var eventToCall = "";

				if((percentage > 0)&&(!sent0))
				{
					sent0 = true;
					eventToCall = "0";
				}
				if((percentage > 25)&&(!sent25))
				{
					sent25 = true;
					eventToCall = "25";
				}
				if((percentage > 50)&&(!sent50))
				{
					sent50 = true;
					eventToCall = "50";
				}
				if((percentage > 75)&&(!sent75))
				{
					sent75 = true;
					eventToCall = "75";
				}

				if(eventToCall != "") NativeInterface.sendMediaPlayerData("time", eventToCall);
			});

			jwplayer().on('complete', function(event){
				NativeInterface.sendMediaPlayerData("complete", "");
			});

			jwplayer().on('playlistComplete', function(event){
				NativeInterface.sendMediaPlayerData("playlistComplete", "");
				NativeInterface.exitView();
			});

			jwplayer().on('playlistItem', function(event){
				if(firstPlaylistElement)  //android jwplayer sends 2 playlistItem events on start
				{
					firstPlaylistElement = false;
					return;
				}

				sent0 = false;
				sent25 = false;
				sent50 = false;
				sent75 = false;
				var elementIndex = event.index;
				NativeInterface.sendMediaPlayerData("playlistItem", elementIndex.toString());
			});

			jwplayer().on('firstFrame', function(event){
				sent0 = false;
				sent25 = false;
				sent50 = false;
				sent75 = false;
				var loadtime = event.loadTime;
				NativeInterface.sendMediaPlayerData("firstFrame", loadtime.toString());
			});

			function getUrlVars()
			{
				var vars = {};
				var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value)
				{
					vars[key] = value;
				});
				return vars;
			}

			function startPlayBack()
			{
				jwplayer().play(true);
			}

			function getBackToLoginScreen()
			{
				NativeInterface.errorOccurred();
			}
</script>
<div id="loadingPage">
	<div id="loadingArea">
		<img src="./circle_1.png" id="circle1">
		<img src="./circle_1.png" id="circle2">
		<img src="./load.png" id="loadingText">
	</div>
</div>
	</body>
</html>
