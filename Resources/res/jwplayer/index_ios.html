<!DOCTYPE HTML>
	<head>
		<title>JW Player</title>
	</head>
	<body bgcolor="white">
		<script src="./jwplayer/jwplayer.js"></script>
		<script>jwplayer.key="BwwBSuXdS5gq/y1wfVzLoplRmFNIiRxUmmVA4PcvyYL3EkiA";</script>

		<div id="videoPlayer"></div>
		<script type="text/javascript">
			var sent0 = false;
			var sent25 = false;
			var sent50 = false;
			var sent75 = false;

			function startBuildingPlayer(receivedPlaylist)
			{
				receivedPlaylist = atob(receivedPlaylist);

				var contentUrl = getUrlVars()["contentUrl"];
				var playerInstance = jwplayer("videoPlayer");

				var playListArray = [];
				var jumpToThisElement = -1;

				if(receivedPlaylist == "noPlaylist")
				{
					playListArray.push({file: contentUrl, mediaid: "episode"});
					jumpToThisElement = 0;
				}
				else
				{
					receivedPlaylist = JSON.parse(receivedPlaylist);

					for(i = 0; i < receivedPlaylist["Elements"].length; i++)
					{
						var uri = receivedPlaylist["Elements"][i]["uri"];
						var imageuri = receivedPlaylist["Elements"][i]["image"];
						var titleText = receivedPlaylist["Elements"][i]["title"];

						playListArray.push({file: uri, mediaid: "episode", image: imageuri, title: titleText});
						if(uri == contentUrl) jumpToThisElement = i;
					}
				}

				playerInstance.setup({

					playlist: playListArray,
					repeat: false,
					stretching: "exactfit",
					mediaid: "azoomeeplayer",
					height: "100%",
					width: "100%"
				});

				jwplayer().playlistItem(jumpToThisElement);

				jwplayer().on('error', function(event){
					window.location.href = "videoerror://videoerror";
				});

				jwplayer().on('setupError', function(event){
					window.location.href = "videoerror://videoerror";
				});

				jwplayer().on('play', function(event){
					if(document.getElementById("loadingScreen"))
					{
						var loadingScreen = document.getElementById("loadingScreen");
						loadingScreen.parentElement.removeChild(loadingScreen);
					}

					window.location.href = "videoevent://video.play";
				});

				jwplayer().on('ready', function(event){
					var loadingScreen = document.getElementById("loadingScreen");
					loadingScreen.innerHTML = '<div button onClick="startPlayBack()" id="loadingText" style="width: 100%; height: 100%; background-image: url(./play.png); width: 100%; height: 100%; background-repeat: no-repeat; background-position: center center; background-size: auto 18%;"></div>';
					startPlayBack();
				});

					jwplayer().on('pause', function(event){
					window.location.href = "videoevent://video.pause";
				});

				jwplayer().on('visualQuality', function(event){
					var currentQuality = jwplayer().getVisualQuality().level;
					window.location.href = "videoevent://video.quality?" + currentQuality["height"];
				});

				jwplayer().on('time', function(event){
					var totalDuration = jwplayer().getDuration();
					var currentPosition = jwplayer().getPosition();

					var percentage = currentPosition / totalDuration * 100;
					var eventToCall = "";

					if((percentage > 0)&&(!sent0))
					{
						sent0 = true;
						eventToCall = "videoevent://video.time?0";
					}
					if((percentage > 25)&&(!sent25))
					{
						sent25 = true;
						eventToCall = "videoevent://video.time?25";
					}
					if((percentage > 50)&&(!sent50))
					{
						sent50 = true;
						eventToCall = "videoevent://video.time?50";
					}
					if((percentage > 75)&&(!sent75))
					{
						sent75 = true;
						eventToCall = "videoevent://video.time?75";
					}

					if(eventToCall != "") window.location.href = eventToCall;
				});

				jwplayer().on('complete', function(event){
					window.location.href = "videoevent://video.complete";
				});

				jwplayer().on('playlistComplete', function(event){
					window.location.href = "videoevent://video.playlistComplete";
					window.location.href = "finishview://finishview";
				});

				jwplayer().on('playlistItem', function(event){
					sent0 = false;
					sent25 = false;
					sent50 = false;
					sent75 = false;
					window.location.href = "videoevent://video.playlistItem?" + event.index.toString();
				});

				jwplayer().on('firstFrame', function(event){
					sent0 = false;
					sent25 = false;
					sent50 = false;
					sent75 = false;
					var loadtime = event.loadTime;
					window.location.href = "videoevent://video.firstFrame?" + loadtime.toString();
				});

				function getUrlVars()
				{
					var vars = {};
					var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value)
					{
						vars[key] = value;
					});
					return vars;
				}
			}

			function startPlayBack()
			{
				jwplayer().play(true);
			}
</script>
<style type="text/css">
			html,body
			{
				height:100%;
				width:100%;
				padding:0;
				margin:0;
			}

			#videoPlayer
			{
				height:100%;
				width:100%;
				padding:0;
			}
		</style>
		<div id="loadingScreen" style="text-align: center; vertical-align: middle; background-color: #000000; position: absolute; left: 0px; top: 0px; bottom: 0px; background-image: url(./loading_bg.jpg); width: 100%; height: 100%; background-repeat: no-repeat; background-position: center center;  background-size: auto 50%;">
			<div id="loadingText" style="width: 100%; height: 100%; background-image: url(./load.png); width: 100%; height: 100%; background-repeat: no-repeat; background-position: center center; background-size: auto 10%;"></div>
		</div>
	</body>
</html>
